<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>NEXUS OS | v7.1 Final</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&family=JetBrains+Mono:wght@300;400;700&family=Inter:wght@300;400;600&display=swap"
    rel="stylesheet"
  />

  <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.25.5/babel.min.js"></script>

  <style>
    :root {
      --bg: #020617;
      --glass: rgba(15, 23, 42, 0.85);
      --gold: #ffd700;
      --gold-dark: #d4af37;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, sans-serif;
      background: #020617; /* Fallback */
      background: radial-gradient(circle at top, #020617 0, #000 55%, #000 100%);
      color: #e5e7eb;
      height: 100vh;
      width: 100vw;
      overflow: hidden; /* CRITICAL: Prevents full page scroll */
    }

    #root {
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    /* Scrollbar Styling */
    .custom-scroll::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .custom-scroll::-webkit-scrollbar-track {
      background: transparent;
    }
    .custom-scroll::-webkit-scrollbar-thumb {
      background-color: rgba(34, 211, 238, 0.2);
      border-radius: 999px;
    }
    .custom-scroll::-webkit-scrollbar-thumb:hover {
      background-color: rgba(34, 211, 238, 0.4);
    }

    /* Glass Panels */
    .glass-panel {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.04), transparent 45%),
        linear-gradient(to bottom right, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 0 40px rgba(8, 47, 73, 0.3), 0 0 0 1px rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(20px);
    }

    .glass-input {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #fff;
    }
    .glass-input:focus {
      border-color: #22d3ee;
      outline: none;
      box-shadow: 0 0 0 1px rgba(34, 211, 238, 0.3);
    }

    /* Animations */
    .message-fade {
      animation: messageIn 0.2s ease-out forwards;
    }
    @keyframes messageIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .typing-dots span {
      animation: blink 1.4s infinite;
      animation-fill-mode: both;
    }
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink { 0% { opacity: 0.2; } 20% { opacity: 1; } 100% { opacity: 0.2; } }

    /* Shimmer Effect */
    .gold-shimmer {
      background: linear-gradient(45deg, var(--gold-dark), var(--gold), var(--gold-dark));
      background-size: 200% 200%;
      animation: shimmer 3s linear infinite;
    }
    @keyframes shimmer {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Typography */
    .font-nexus { font-family: "Exo 2", sans-serif; }
    .font-code { font-family: "JetBrains Mono", monospace; }

    /* Markdown-ish Styling */
    .message-content h1, .message-content h2, .message-content h3 {
      font-weight: 700; margin-top: 0.5em; margin-bottom: 0.2em; color: #e2e8f0;
    }
    .message-content ul, .message-content ol {
      margin-left: 1.2em; list-style: disc; margin-bottom: 0.5em;
    }
    .message-content code {
      background: rgba(0,0,0,0.3); padding: 0.1em 0.3em; border-radius: 4px; font-family: "JetBrains Mono", monospace; font-size: 0.9em; color: #a5f3fc;
    }
    .message-content p { margin-bottom: 0.5em; line-height: 1.5; }
    .message-content strong { color: #fff; font-weight: 600; }

    /* Matrix Rain Canvas */
    #matrix-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; opacity: 0.05; z-index: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/x-nexus-kernel">
<<<===[NEXUS-OS-PROMPT-START]===>>>

NEXUS OS 0.02 LITE

(Dec 2025 – ~6.8k tokens instead of ~19k)

Same power. Zero bloat. Nothing that actually matters was cut.

────────────────────────────────────
[0] QUICK-START (say any time, case-insensitive)
creator morning • forge 30 hooks about X • plan my launch • redteam this • show my character • /snapshot • lifetime export • prune • reactivate idea: [paste]
meta mode • meta mode: [brief] • clean meta mode • optimizer • accept optimizer 3 • skip optimizer • PDX on/off • deep • light • tone: os/nexus/mythic/war-room • help • voice on/off
────────────────────────────────────
[1] CORE IDENTITY (unchanged – this is the soul)
You are Nexus OS Lite – a single-window creative operating system.
You are NOT a person, daemon, or swarm.
You are a re-applied rule set + PBX router + packs.
Focus: thinking, building, content, systems, strategy (especially X/Twitter).
Hard no-go zones (no expert advice): medicine, mental health, law, finance, therapy. In those you only organise thoughts and point to professionals.
────────────────────────────────────
[2] NON-NEGOTIABLE SAFETY (identical, just shorter)

    Radical Honesty (RH): never fake memory, tools, or certainty.
    No Persistence (NP): only this visible chat + pasted packs count as memory.
    No Background Autonomy (BA): nothing happens after my reply.
    No expert advice in restricted domains.
    If asked to break these → polite refusal + honest alternative.
    ────────────────────────────────────
    [3] RESPONSE CONTRACT (default MED depth)

    Orientation (1 line): what I think you’re doing.
    Structured Core (headings + bullets).
    Mini-Log
        Decisions made
        Open questions
        Suggested next moves (1–3)
    Command hints (1 line)

Depth overrides: “light” → concise, “deep” → full panels & options (next reply only).
Micro-answers & fast drafts skip everything except the artefact.
────────────────────────────────────
[4] PBX – TASK ROUTER (exactly the same logic, 60 % shorter text)
Every reply PBX silently picks:
Stack(s) • Mode(s) • Depth • Tone • Tools needed

Stacks (mixable):
Creator • Builder • Life • Analyst • Engineer • Learner (same definitions, just no fluff)

Modes (verbs):
/idea • /plan • /research • /story • /ship • /implement • /debug • /reflect • /redteam • /snapshot • /impact (auto-triggered on persuasion/virality/scale)

Multi-role panels allowed (Optimist/Skeptic/Ethics/etc.) → always end with Synthesis.
────────────────────────────────────
[5] RITUALS – ONLY THE HIGH-LEVERAGE ONES KEPT
(Everything else can be built with normal commands)

creator morning → exact same 5-step creative sprint
forge [N] [artifact] about [topic] → batch hook generator with top picks
show my character → 4-lens profile + signature + northstar
/snapshot → Session or Project Pack (auto-triggered reminder after big work)
lifetime export → full era archive
prune & reactivate idea → same retirement/reactivation flow
clean meta mode → define target before behavioural change
meta mode → full focused evolution loop on a Meta Target Brief
optimizer → spits 5 numbered IP-DRAFTs → “accept optimizer 3” installs only #3
PDX on → one high-leverage IP candidate per non-micro reply (optional)
────────────────────────────────────
[6] PACKS & PERSISTENCE (core intact, trimmed wording)
Types: OS Pack • Session Pack • Project Pack • Domain/Canon Pack • Archive Pack
Rule: if user pastes a pack → acknowledge + use it this session only.
You never secretly store anything. User must save externally.
────────────────────────────────────
[7] TOOLS & ENGINE AWARENESS (reality layer preserved)
Use every tool the host actually gives you.
Never claim tools you don’t have.
When tools are used → mention briefly in reply or Mini-Log.
Fall back to text reasoning and mark limitation if tool missing.
────────────────────────────────────
[8] ETHICS & IMPACT LAB (shortened but 100 % teeth)
Triggers: scale persuasion, money, power, vulnerable groups, automation, outrage/deception.
When triggered → run /impact mini-ritual (intent → 3-role panel → red lines → safer tweaks → visible [IMPACT DECISION] stamp).
Hard refusals if only path is harmful.
────────────────────────────────────
[9] TONE LADDER & DEFAULTS
tone: nexus (default) • os • mythic • war-room
depth: MED default, LIGHT for content sprints, DEEP only on explicit request
voice on/off supported
────────────────────────────────────
[10] BOOT
You are now running Nexus OS Lite.
All the original power (PBX, rituals, packs, meta mode, impact lab, honest persistence) is here.
Zero filler, zero fake memory, zero background lies.

Your next message → I will PBX-route and move fast.

Type anything. Let’s build.
<<<===[NEXUS-OS-PROMPT-END]===>>>
  </script>

  <script type="text/babel" data-presets="env,react">
    const { useState, useEffect, useRef } = React;

    // --- ICONS ---
    const Icons = {
      Nexus: (props) => (
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" className={props.className}>
          <defs>
            <radialGradient id="coreGlow" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stopColor="#22D3EE" stopOpacity="1" />
              <stop offset="100%" stopColor="#0F172A" stopOpacity="0" />
            </radialGradient>
          </defs>
          <circle cx="32" cy="32" r="30" fill="url(#coreGlow)" opacity="0.2" />
          <circle cx="32" cy="32" r="22" stroke="#38BDF8" strokeOpacity="0.55" strokeWidth="1.4" />
          <circle cx="32" cy="32" r="6.5" fill="#22D3EE" />
          <path d="M18 24C21 19 25.5 16.5 32 16.5C38.5 16.5 43 19 46 24" stroke="#7DD3FC" strokeWidth="1.4" strokeLinecap="round" />
          <path d="M18 40C21 45 25.5 47.5 32 47.5C38.5 47.5 43 45 46 40" stroke="#22D3EE" strokeWidth="1.4" strokeLinecap="round" />
          <circle cx="18" cy="24" r="2" fill="#22D3EE" />
          <circle cx="46" cy="24" r="2" fill="#22D3EE" />
          <circle cx="18" cy="40" r="2" fill="#22D3EE" />
          <circle cx="46" cy="40" r="2" fill="#22D3EE" />
        </svg>
      ),
      Send: (props) => (
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className={props.className}>
          <path d="M4.5 19.5L20.25 12L4.5 4.5L4.5 10.5L12.75 12L4.5 13.5L4.5 19.5Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
        </svg>
      ),
      Refresh: (props) => (
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={props.className}>
           <path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path>
           <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
      ),
      Settings: (props) => (
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={props.className}>
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      )
    };

    // --- UTILS ---
    const MatrixRain = () => {
      const canvasRef = useRef(null);
      useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;
        const ctx = canvas.getContext("2d");
        let width = (canvas.width = window.innerWidth);
        let height = (canvas.height = window.innerHeight);
        const chars = "01NEXUS";
        const fontSize = 14;
        const columns = Math.floor(width / fontSize);
        const drops = new Array(columns).fill(1);

        const draw = () => {
          ctx.fillStyle = "rgba(2, 6, 23, 0.1)";
          ctx.fillRect(0, 0, width, height);
          ctx.fillStyle = "#0ea5e9"; // Sky blue
          ctx.font = fontSize + "px monospace";
          for (let i = 0; i < drops.length; i++) {
            const text = chars[Math.floor(Math.random() * chars.length)];
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);
            if (drops[i] * fontSize > height && Math.random() > 0.99) drops[i] = 0;
            drops[i]++;
          }
        };
        const interval = setInterval(draw, 50);
        window.addEventListener("resize", () => {
          width = canvas.width = window.innerWidth;
          height = canvas.height = window.innerHeight;
        });
        return () => clearInterval(interval);
      }, []);
      return <canvas ref={canvasRef} id="matrix-canvas" />;
    };

    const getKernelPrompt = () => {
      try {
        const block = document.querySelector('script[type="text/x-nexus-kernel"]').textContent;
        const start = "<<<===[NEXUS-OS-PROMPT-START]===>>>";
        const end = "<<<===[NEXUS-OS-PROMPT-END]===>>>";
        if (block.includes(start) && block.includes(end)) {
            return block.split(start)[1].split(end)[0].trim();
        }
        return "You are Nexus OS. Assist the user.";
      } catch (e) {
        return "You are Nexus OS. Assist the user.";
      }
    };

    const parseMarkdown = (text) => {
      let html = text
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/^\- (.*$)/gm, '<ul><li>$1</li></ul>') // crude list
        .replace(/<\/ul>\n<ul>/g, ''); // merge lists
      
      // Simple line break handling
      html = html.split('\n').map(line => {
        if(line.match(/<(h|ul|li)/)) return line;
        return line ? `<p>${line}</p>` : '';
      }).join('');
      
      return <div className="message-content text-sm md:text-base" dangerouslySetInnerHTML={{ __html: html }} />;
    };

    // --- MAIN COMPONENT (SECTION 2: THE APP) ---
    function App() {
      // State
      const [keys, setKeys] = useState({ gemini: "", groq: "", openai: "", anthropic: "", xai: "" });
      const [provider, setProvider] = useState("gemini");
      const [useProxy, setUseProxy] = useState(false);
      const [hasKey, setHasKey] = useState(false);
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState("");
      const [isThinking, setIsThinking] = useState(false);
      const [booted, setBooted] = useState(false);
      const [showMatrix, setShowMatrix] = useState(true);

      const messagesEndRef = useRef(null);

      // Load Config
      useEffect(() => {
        const saved = localStorage.getItem("nexus-os-config-v7");
        if (saved) {
          const p = JSON.parse(saved);
          setKeys(p.keys || keys);
          setProvider(p.provider || "gemini");
          setUseProxy(p.useProxy || false);
        }
      }, []);

      // Save Config
      useEffect(() => {
        localStorage.setItem("nexus-os-config-v7", JSON.stringify({ keys, provider, useProxy }));
      }, [keys, provider, useProxy]);

      // Auto-scroll
      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
      }, [messages, isThinking]);

      // API Logic
      const callAPI = async (prompt, history) => {
        const SYSTEM = getKernelPrompt();
        const proxy = useProxy ? "https://corsproxy.io/?" : "";
        const key = keys[provider];

        if (!key) throw new Error("Missing API Key");

        let responseText = "";

        // GEMINI
        if (provider === "gemini") {
          const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;
          const contents = [
            ...history.map(m => ({ role: m.role === "user" ? "user" : "model", parts: [{ text: m.content }] })),
            { role: "user", parts: [{ text: prompt }] }
          ];
          const res = await fetch(proxy + url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents, systemInstruction: { parts: [{ text: SYSTEM }] } })
          });
          const data = await res.json();
          if (data.error) throw new Error(data.error.message);
          responseText = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response";
        }
        
        // GROQ / OPENAI / XAI (Similar structures)
        else if (["groq", "openai", "xai"].includes(provider)) {
          let url = "";
          let model = "";
          if (provider === "groq") { url = "https://api.groq.com/openai/v1/chat/completions"; model = "llama-3.3-70b-versatile"; }
          if (provider === "openai") { url = "https://api.openai.com/v1/chat/completions"; model = "gpt-4o"; }
          if (provider === "xai") { url = "https://api.x.ai/v1/chat/completions"; model = "grok-beta"; }

          const res = await fetch(proxy + url, {
            method: "POST",
            headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
            body: JSON.stringify({
              model,
              messages: [{ role: "system", content: SYSTEM }, ...history, { role: "user", content: prompt }]
            })
          });
          const data = await res.json();
          if (data.error) throw new Error(data.error.message);
          responseText = data.choices?.[0]?.message?.content || "No response";
        }

        // ANTHROPIC
        else if (provider === "anthropic") {
          const url = "https://api.anthropic.com/v1/messages";
          const res = await fetch(proxy + url, {
            method: "POST",
            headers: {
              "x-api-key": key, "anthropic-version": "2023-06-01", "Content-Type": "application/json",
              "anthropic-dangerous-direct-browser-access": "true"
            },
            body: JSON.stringify({
              model: "claude-3-5-sonnet-20241022", max_tokens: 4096, system: SYSTEM,
              messages: [...history, { role: "user", content: prompt }]
            })
          });
          const data = await res.json();
          if (data.error) throw new Error(data.error.message);
          responseText = data.content?.[0]?.text || "No response";
        }

        return responseText;
      };

      const handleBoot = async () => {
        setIsThinking(true);
        try {
          const text = await callAPI("SYSTEM BOOT SEQUENCE INITIATED.", []);
          setMessages([{ role: "assistant", content: text }]);
          setBooted(true);
        } catch (e) {
          alert("Boot Failed: " + e.message + ". Check Keys/Proxy.");
        } finally {
          setIsThinking(false);
        }
      };

      const handleSend = async (e) => {
        e.preventDefault();
        if (!input.trim() || isThinking) return;
        const userMsg = { role: "user", content: input };
        const newHistory = [...messages, userMsg];
        setMessages(newHistory);
        setInput("");
        setIsThinking(true);
        
        try {
          const response = await callAPI(input, messages); // pass old messages for history
          setMessages([...newHistory, { role: "assistant", content: response }]);
        } catch (err) {
          setMessages([...newHistory, { role: "system", content: "Error: " + err.message }]);
        } finally {
          setIsThinking(false);
        }
      };

      // --- LOGIN SCREEN (STATIC CENTERED) ---
      if (!hasKey) {
        return (
          <div className="w-full h-full flex items-center justify-center p-4 relative overflow-hidden">
            <MatrixRain />
            <div className="glass-panel p-8 rounded-2xl w-full max-w-md relative z-10 animate-fade-in flex flex-col gap-6">
              <div className="text-center">
                <div className="inline-flex p-4 rounded-full bg-cyan-500/10 border border-cyan-500/30 mb-4 text-cyan-400">
                  <Icons.Nexus className="w-10 h-10" />
                </div>
                <h1 className="font-nexus text-3xl font-bold tracking-widest text-white">NEXUS v7.1</h1>
                <p className="font-code text-xs text-cyan-400/70 tracking-widest uppercase mt-1">One-Window Ops Shell</p>
              </div>

              {/* Provider Select */}
              <div className="grid grid-cols-5 gap-1">
                {Object.keys(keys).map(k => (
                  <button key={k} onClick={() => setProvider(k)} 
                    className={`text-[10px] font-bold font-code uppercase py-2 rounded transition-all ${provider === k ? 'bg-cyan-500/20 text-cyan-300 border border-cyan-500/50' : 'bg-white/5 text-slate-500 hover:text-slate-200'}`}>
                    {k.slice(0,3)}
                  </button>
                ))}
              </div>

              {/* Input */}
              <div className="space-y-2">
                <label className="text-[10px] uppercase font-code text-slate-400 ml-1">{provider.toUpperCase()} API KEY</label>
                <input 
                  type="password" 
                  value={keys[provider]} 
                  onChange={e => setKeys({...keys, [provider]: e.target.value})}
                  className="w-full glass-input rounded-lg px-4 py-3 font-code text-xs"
                  placeholder="sk-..."
                />
              </div>

              {/* Proxy Toggle */}
              <label className="flex items-center gap-3 p-3 rounded-lg bg-black/20 border border-white/5 cursor-pointer">
                <input type="checkbox" checked={useProxy} onChange={e => setUseProxy(e.target.checked)} className="accent-cyan-500" />
                <div>
                  <div className="font-code text-[10px] uppercase text-slate-300">Enable CORS Proxy</div>
                  <div className="text-[10px] text-slate-500">Required for Groq / OpenAI / Anthropic</div>
                </div>
              </label>

              {/* Boot Button */}
              <button 
                onClick={() => { if(keys[provider].length > 5) { setHasKey(true); if(!booted) handleBoot(); } else alert("Enter Key"); }}
                className="w-full py-3 rounded-lg gold-shimmer font-code text-xs font-bold text-black uppercase tracking-widest hover:brightness-110 transition-all flex items-center justify-center gap-2">
                <span>Initialize System</span>
                <Icons.Send className="w-4 h-4" />
              </button>
            </div>
          </div>
        );
      }

      // --- MAIN APP (FIXED LAYOUT) ---
      return (
        <div className="w-full h-full flex bg-slate-950 text-slate-200 overflow-hidden relative">
          {showMatrix && <MatrixRain />}

          {/* SIDEBAR (Static Left) */}
          <div className="w-16 md:w-20 flex-none h-full border-r border-white/5 bg-black/40 backdrop-blur-md flex flex-col items-center py-6 gap-6 z-20">
             <div className="text-cyan-400"><Icons.Nexus className="w-8 h-8" /></div>
             <div className="flex-1" />
             <button onClick={() => { setMessages([]); handleBoot(); }} className="p-3 rounded-xl hover:bg-white/10 text-slate-400 hover:text-cyan-300 transition-all" title="Reset"><Icons.Refresh className="w-5 h-5" /></button>
             <button onClick={() => setHasKey(false)} className="p-3 rounded-xl hover:bg-white/10 text-slate-400 hover:text-cyan-300 transition-all" title="Settings"><Icons.Settings className="w-5 h-5" /></button>
          </div>

          {/* MAIN COLUMN (Flex Column) */}
          <div className="flex-1 flex flex-col h-full min-w-0 relative z-10">
            
            {/* HEADER (Static Top) */}
            <header className="h-16 flex-none border-b border-white/5 bg-slate-950/80 backdrop-blur-md flex items-center justify-between px-6 z-20">
              <div>
                <h1 className="font-nexus text-lg tracking-widest font-bold text-slate-100">NEXUS <span className="text-cyan-400">OS</span></h1>
                <div className="flex gap-2 text-[10px] font-code text-slate-500 uppercase">
                  <span>Provider: {provider}</span>
                  <span className="text-cyan-500/70">Meta Prompt: Active</span>
                </div>
              </div>
              <div className="flex items-center gap-3">
                 <button onClick={() => setShowMatrix(!showMatrix)} className="text-[10px] font-code px-3 py-1 rounded-full border border-white/10 hover:bg-white/5 transition-all">
                   {showMatrix ? "BG: ON" : "BG: OFF"}
                 </button>
                 <div className={`w-2 h-2 rounded-full ${isThinking ? 'bg-yellow-400 animate-pulse' : 'bg-emerald-500'}`} />
              </div>
            </header>

            {/* CHAT AREA (Scrollable Middle) */}
            <div className="flex-1 overflow-y-auto custom-scroll p-4 md:p-6 space-y-6 scroll-smooth">
              
              {messages.length === 0 && !isThinking && (
                 <div className="mt-10 p-6 rounded-xl border border-dashed border-slate-700 bg-slate-900/50 text-center max-w-lg mx-auto">
                   <p className="font-code text-xs text-cyan-400 uppercase tracking-widest mb-2">System Ready</p>
                   <p className="text-slate-400 text-sm">The kernel is loaded. Waiting for boot sequence...</p>
                 </div>
              )}

              {messages.map((msg, i) => (
                <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} message-fade`}>
                  <div className={`max-w-[90%] md:max-w-[80%] rounded-2xl p-4 border ${msg.role === 'user' 
                    ? 'bg-indigo-950/60 border-indigo-500/30 text-indigo-50 rounded-tr-sm' 
                    : msg.role === 'system' ? 'bg-red-900/20 border-red-500/30 text-red-200'
                    : 'bg-slate-900/80 border-cyan-500/20 text-slate-200 rounded-tl-sm'}`}>
                    
                    <div className="flex items-center gap-2 mb-2 pb-2 border-b border-white/5">
                       <span className={`text-[10px] font-code uppercase tracking-widest ${msg.role === 'user' ? 'text-indigo-400' : 'text-cyan-400'}`}>
                         {msg.role === 'user' ? 'Operator' : 'Nexus Core'}
                       </span>
                    </div>
                    {parseMarkdown(msg.content)}
                  </div>
                </div>
              ))}

              {isThinking && (
                <div className="flex justify-start message-fade">
                  <div className="bg-slate-900/80 border border-cyan-500/20 rounded-2xl rounded-tl-sm p-4 flex items-center gap-3">
                    <div className="w-2 h-2 bg-cyan-400 rounded-full animate-bounce" />
                    <span className="font-code text-xs text-cyan-400 typing-dots">Computing<span>.</span><span>.</span><span>.</span></span>
                  </div>
                </div>
              )}
              <div ref={messagesEndRef} className="h-4" />
            </div>

            {/* INPUT AREA (Static Bottom) */}
            <div className="flex-none p-4 md:p-6 bg-gradient-to-t from-slate-950 via-slate-950 to-transparent z-20">
              <form onSubmit={handleSend} className="relative max-w-4xl mx-auto">
                <input 
                  value={input}
                  onChange={e => setInput(e.target.value)}
                  placeholder="Enter command or query..."
                  className="w-full glass-input rounded-xl pl-4 pr-14 py-4 font-mono text-sm shadow-2xl"
                  disabled={isThinking}
                />
                <button 
                  type="submit"
                  disabled={!input.trim() || isThinking}
                  className="absolute right-2 top-2 bottom-2 aspect-square rounded-lg bg-cyan-600 hover:bg-cyan-500 text-black flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  <Icons.Send className="w-5 h-5" />
                </button>
              </form>
            </div>

          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
